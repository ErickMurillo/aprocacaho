{% extends "base.html" %}
{% load helpertags %}

{% block content %}
{% include "productores/filtros.html" %}
<div id="tabs">
  <!-- Nav tabs -->
  <ul class="nav" role="navegacion">
    <li role="titulo">
      <a >Años:</a>
    </li>

    {% for year in years.keys %}
    <li role="annos" class="{% if forloop.counter == 1 %}active{% endif %}" id="{{forloop.counter}}">
      <a href="#{{year}}" class="update" aria-controls="{{year}}" role="tab" data-toggle="tab">{{year}}</a>
    </li>
    {% endfor %}
  </ul>

  <div class="tab-content">
    {% for year,value in years.items %}
    <div role="tabpanel" class="tab-pane {% if forloop.counter == 1 %}active{% endif %}" id="{{year}}">
      <h5>costo promedio de inversión para cacao: {{value.7}}</h5>
      <h5>costo promedio de inversión para finca: {{value.8}}</h5>
      <div id="certificaciones{{year}}" style="min-width: 310px; width: 540px; margin: 0 auto;"></div>
      <div id="prod_cert{{year}}" style="min-width: 310px; width: 540px; margin: 0 auto;"></div>
      <div id="cert{{year}}" style="min-width: 310px; width: 540px; margin: 0 auto;"></div>
      <div id="certifica{{year}}" style="min-width: 310px; width: 540px; margin: 0 auto;"></div>
      <div id="paga{{year}}" style="min-width: 310px; width: 540px; margin: 0 auto;"></div>
    </div>

    </div>
    {% endfor %}
  </div>
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">
$(function () {
  {% for year,value in years.items %}
  $('#certificaciones{{year}}').highcharts({
   chart: {
       type: 'column'
   },
   title: {
       text: 'Tipos de certificación. Total de productores({{value.0}})'
   },
   yAxis: {
       title: {
           text: 'Valores'
       }
   },
   credits: {
       enabled: false
   },
   yAxis: {
           min: 0,
           title: {
               text: 'Porcentajes (%)'
           }
       },
       tooltip: {
           formatter: function() {
               return ''+
                   this.series.name +': '+ this.y +'%';
           }
       },
   series: [
           {% for k,v in value.1.items %}
           {
               name: '{{k}} ({{v}})',
               data: [{{v|percentage:value.0|floatformat:2}}],
               dataLabels: {
                   enabled: true,
                   rotation: 0,
                   color: '#632D00',
                   align: 'center',
                   x: -3,
                   y: 0,
                       formatter: function() {
                           return this.y + '%';
                                             },
                   style: {
                       font: 'normal 13px Verdana, sans-serif'
                           }
                           }
           },
           {% endfor %}
           ]
});

$('#prod_cert{{year}}').highcharts({
  chart: {
    plotBackgroundColor: null,
    plotBorderWidth: null,
    plotShadow: false,
    type: 'pie'
  },
  title: {
    text: 'Número de productores certificados'
  },
  tooltip: {
    pointFormat: '{series.name}: <b>{point.y:.2f}%</b>'
  },
  plotOptions: {
    pie: {
      allowPointSelect: true,
      cursor: 'pointer',
      dataLabels: {
        enabled: true,
        format: '{point.percentage:.2f}%',
        color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black',
        style: {
          textShadow: '0 0 3px white'
        }
      },
      showInLegend: true
    }

  },
  series: [{
    name: "Porcentajes",
    colorByPoint: true,
    data: [
    {
      name: "Certificados ({{value.2}})",
      y: {{value.2}}
    },
    {
      name: "No certificados ({{value.3}})",
      y: {{value.3}},
      sliced: true,
      selected: true
    },


    ]
  }]
});

$('#cert{{year}}').highcharts({
    chart: {
        type: 'column'
    },
    title: {
        text: 'Número de productores con uno o más sellos'
    },
    yAxis: {
        title: {
            text: 'Valores'
        }

    },
    yAxis: {
        min: 0,
        title: {
            text: 'Productores'
        }
    },
    xAxis: {
        categories: [
        'Productores',

        ],
        crosshair: true
    },
    tooltip: {
        formatter: function() {
            return ''+
            this.series.name +': '+ this.y ;
        }
    },
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        borderWidth: 0
    },
    plotOptions: {
        series: {
            borderWidth: 0,
            dataLabels: {
                enabled: true,
                format: '{point.y}',
                color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black',
                style: {
                    textShadow: '0 0 3px white'
                }
            }
        }
    },
    series: [
    {% for list in value.4  %}
        {% for x in list %}
            {% if forloop.counter == 1 %}
            {
                name: "Con un sello",
                data: [{{x}}],
            },
            {% elif forloop.counter == 2 %}
            {
                name: "Con dos sellos",
                data: [{{x}}],
            },
            {% else %}
            {
                name: "Más de dos sellos",
                data: [{{x}}],
            },
            {% endif %}

        {% endfor %}

    {% endfor %}
    ]
});

$('#certifica{{year}}').highcharts({
  chart: {
    plotBackgroundColor: null,
    plotBorderWidth: null,
    plotShadow: false,
    type: 'pie'
  },
  title: {
    text: '¿Quién certifica?'
  },
  tooltip: {
    pointFormat: '{series.name}: <b>{point.y:.2f}%</b>'
  },
  plotOptions: {
    pie: {
      allowPointSelect: true,
      cursor: 'pointer',
      dataLabels: {
        enabled: true,
        format: '{point.percentage:.2f}%',
        color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black',
        style: {
          textShadow: '0 0 3px white'
        }
      },
      showInLegend: true
    }

  },
  series: [{
    name: "Porcentajes",
    colorByPoint: true,
    data: [
      {% for k,v in value.5.items %}
      {
        name: "{{k}}",
        y: {{v}},
        {% if forloop.counter == 1 %}
        sliced: true,
        selected: true
        {% endif %}
      },
      {% endfor %}
    ]
  }]
});

$('#paga{{year}}').highcharts({
  chart: {
    plotBackgroundColor: null,
    plotBorderWidth: null,
    plotShadow: false,
    type: 'pie'
  },
  title: {
    text: '¿Quién paga la certificación?'
  },
  tooltip: {
    pointFormat: '{series.name}: <b>{point.y:.2f}%</b>'
  },
  plotOptions: {
    pie: {
      allowPointSelect: true,
      cursor: 'pointer',
      dataLabels: {
        enabled: true,
        format: '{point.percentage:.2f}%',
        color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black',
        style: {
          textShadow: '0 0 3px white'
        }
      },
      showInLegend: true
    }

  },
  series: [{
    name: "Porcentajes",
    colorByPoint: true,
    data: [
      {% for k,v in value.6.items %}
      {
        name: "{{k}}",
        y: {{v}},
        {% if forloop.counter == 1 %}
        sliced: true,
        selected: true
        {% endif %}
      },
      {% endfor %}
    ]
  }]
});
{% endfor %}
});
</script>
{% endblock extra_js %}
